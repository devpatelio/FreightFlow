{% extends "base.html" %}

{% block title %}{{ schema_data.template_name }} - Form Schema{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1>{{ schema_data.template_name }}</h1>
        <p class="subtitle">{{ schema_data.description or 'Form schema details' }}</p>
    </div>
    <div class="actions-bar">
        <a href="{{ url_for('schemas_list') }}" class="btn btn-secondary">← Back to Schemas</a>
        <form method="POST"
              action="{{ url_for('schemas_delete', template_name=schema_data.template_name) }}"
              style="display: inline;"
              onsubmit="return confirm('Are you sure you want to delete this schema?');">
            <button type="submit" class="btn btn-danger">Delete Schema</button>
        </form>
    </div>
</div>

<div class="schema-view-grid">
    <div class="schema-view-left">
        <div class="section">
            <h2>Schema Information</h2>
            <table class="info-table">
                <tr>
                    <th>Template Name:</th>
                    <td>{{ schema_data.template_name }}</td>
                </tr>
                <tr>
                    <th>Number of Fields:</th>
                    <td><span class="badge badge-info">{{ schema_data.num_fields }} fields</span></td>
                </tr>
                <tr>
                    <th>Template File ID:</th>
                    <td><code class="inline-code">{{ schema_data.template_file_id or 'N/A' }}</code></td>
                </tr>
                <tr>
                    <th>Created:</th>
                    <td>{{ schema_data.created_at }}</td>
                </tr>
                <tr>
                    <th>Last Updated:</th>
                    <td>{{ schema_data.updated_at }}</td>
                </tr>
                <tr>
                    <th>Description:</th>
                    <td>{{ schema_data.description or 'No description provided' }}</td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h2>Field Summary</h2>
            {% set field_types = {} %}
            {% for field in schema_data.schema %}
                {% set _ = field_types.update({field.type: field_types.get(field.type, 0) + 1}) %}
            {% endfor %}

            <div class="field-type-stats">
                {% for field_type, count in field_types.items() %}
                <div class="field-type-stat">
                    <span class="field-type-badge badge-{{ field_type }}">{{ field_type }}</span>
                    <span class="field-type-count">{{ count }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="schema-view-right">
        <div class="section">
            <h2>Field Details</h2>
            <div class="fields-list">
                {% for field in schema_data.schema %}
                <div class="field-item">
                    <div class="field-header">
                        <span class="field-type-badge badge-{{ field.type }}">{{ field.type }}</span>
                        <strong>{{ field.description }}</strong>
                    </div>
                    <div class="field-details">
                        <div class="field-meta">
                            <span>Page {{ field.bbox.page }}</span>
                            <span>Position: ({{ "%.3f"|format(field.bbox.left) }}, {{ "%.3f"|format(field.bbox.top) }})</span>
                            <span>Size: {{ "%.3f"|format(field.bbox.width) }} × {{ "%.3f"|format(field.bbox.height) }}</span>
                        </div>
                        {% if field.value %}
                        <div class="field-value">Fixed value: <code class="inline-code">{{ field.value }}</code></div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div class="section">
    <div class="section-header">
        <h2>Raw Schema JSON</h2>
        <button onclick="copyToClipboard()" class="btn btn-secondary">Copy to Clipboard</button>
    </div>
    <pre class="code-block">{{ schema_json }}</pre>
</div>

<script>
function copyToClipboard() {
    const schemaJson = {{ schema_json|tojson }};
    navigator.clipboard.writeText(schemaJson).then(() => {
        alert('Schema copied to clipboard!');
    }).catch(err => {
        console.error('Failed to copy:', err);
    });
}
</script>

{% endblock %}

